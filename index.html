<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Browser Compatibility Check</title>
    <style>
      body {
        display: none; /* Hide content when JS is enabled */
      }
      .no-js {
        display: block; /* Show only if JS is disabled */
      }
    </style>
    <noscript>
      <style>
        body {
          display: block;
        }
      </style>
      <div class="no-js">
        <p>JavaScript is disabled in your browser. Please enable it to continue.</p>
      </div>
    </noscript>
  </head>
  <body>
    <p>Checking browser support...</p>

    <script>
      document.body.style.display = 'block'; // Show content if JS is enabled

      async function checkCompatibility() {
        try {
          // Checking ES6 Modules support
          new Function("import('data:text/javascript,')");

          // Check JavaScript support (Fetch, Promises, Async/Await etc.)
          if (!('fetch' in window)) throw new Error('Fetch API not supported');
          if (!('Promise' in window)) throw new Error('Promises not supported');
          new Function('async function test() {}')();
          if (!('serviceWorker' in navigator)) throw new Error('Service Workers not supported');
          if (!('WebSocket' in window)) throw new Error('WebSockets not supported');
          if (!('IntersectionObserver' in window)) throw new Error('IntersectionObserver not supported');
          if (!('clipboard' in navigator)) throw new Error('Clipboard API not supported');
          if (!('WebAssembly' in window)) throw new Error('WebAssembly not supported');
          if (!('RTCPeerConnection' in window)) throw new Error('WebRTC not supported');

          // Checking support for modern CSS properties
          if (!CSS.supports('display', 'grid')) throw new Error('CSS Grid not supported');
          if (!CSS.supports('display', 'flex')) throw new Error('CSS Flexbox not supported');
          if (!CSS.supports('(--a: 0)')) throw new Error('CSS Custom Properties not supported');

          // Check CSS prefix support
          const prefixes = ['-webkit-', '-moz-', '-ms-', '-o-'];
          const propertiesToCheck = ['transform', 'transition', 'animation', 'box-shadow', 'flex'];
          propertiesToCheck.forEach((property) => {
            if (!CSS.supports(property, 'initial')) {
              let supported = false;
              prefixes.forEach((prefix) => {
                if (CSS.supports(prefix + property, 'initial')) {
                  supported = true;
                }
              });
              if (!supported) {
                throw new Error(`CSS property ${property} with prefixes not supported`);
              }
            }
          });

          // Checking internet access
          if (!navigator.onLine) {
            console.warn('No internet access: User offline');
            return; // Do not interrupt the activity, but note the lack of internet
          }

          // Try to download a small resource to check real internet access
          try {
            const response = await fetch('https://example.com/ping.txt', {method: 'HEAD', mode: 'no-cors'});
            if (!response.ok) throw new Error('Error while checking internet');
          } catch (e) {
            console.warn('Cannot connect to resource, no internet access:', e.message);
          }

          // Redirect to main page if all tests are successful
          window.location.href = './html/game.html';
        } catch (e) {
          console.warn('Compatibility check failed:', e.message);
          window.location.href = './html/no-support.html';
        }
      }

      checkCompatibility();
    </script>
  </body>
</html>
